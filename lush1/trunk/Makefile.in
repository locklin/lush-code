#;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
#;;;
#;;; LUSH Lisp Universal Shell
#;;;   Copyright (C) 2002 Leon Bottou, Yann Le Cun, AT&T Corp, NECI.
#;;; Includes parts of TL3:
#;;;   Copyright (C) 1987-1999 Leon Bottou and Neuristique.
#;;; Includes selected parts of SN3.2:
#;;;   Copyright (C) 1991-2001 AT&T Corp.
#;;;
#;;; This program is free software; you can redistribute it and/or modify
#;;; it under the terms of the GNU General Public License as published by
#;;; the Free Software Foundation; either version 2 of the License, or
#;;; (at your option) any later version.
#;;;
#;;; This program is distributed in the hope that it will be useful,
#;;; but WITHOUT ANY WARRANTY; without even the implied warranty of
#;;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#;;; GNU General Public License for more details.
#;;;
#;;; You should have received a copy of the GNU General Public License
#;;; along with this program; if not, write to the Free Software
#;;; Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA
#;;;
#;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

#;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
#;;; $Id: Makefile.in,v 1.13 2003-01-10 23:59:13 leonb Exp $
#;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

@SET_MAKE@
SHELL = @SHELL@
VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = .
mybindir = ./bin
mysysdir = ./sys

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@
libdir = @libdir@
mandir = @mandir@

MV = @MV@
RM = @RM@
LN_S = @LN_S@
INSTALL = @INSTALL@

#;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

SUBDIRS=src

world: all

all depend clean: FORCE
	for d in ${SUBDIRS} ; \
	  do ( cd $$d && ${MAKE} $@ ) || exit ; done
	${MAKE} post-$@

${mybindir}/lush: FORCE
	@test -d ${mybindir} || mkdir ${mybindir}
	@test -r ${mybindir}/lush~3 && \
	  ${MV} ${mybindir}/lush~3 ${mybindir}/lush~4 || true
	@test -r ${mybindir}/lush~2 && \
	  ${MV} ${mybindir}/lush~2 ${mybindir}/lush~3 || true
	@test -r ${mybindir}/lush~1 && \
	  ${MV} ${mybindir}/lush~1 ${mybindir}/lush~2 || true
	@test -r ${mybindir}/lush && \
          ${MV} ${mybindir}/lush ${mybindir}/lush~1 || true
	${INSTALL} -m 755 src/lush ${mybindir}

${mysysdir}/stdenv.dump: FORCE
	${mybindir}/lush @sysenv stdenv -- ${mysysdir}/stdenv.dump

dump: ${mysysdir}/stdenv.dump 

post-all: ${mybindir}/lush ${mysysdir}/stdenv.dump
	@echo "-------------------------------------------------------"
	@echo "Congratulations: the compilation was successful!"
	@echo ""
	@echo "Lush is designed to run from the compilation directory."
	@echo "Simply include" `pwd`"/bin in your shell search path,"
	@echo "or create a symlink to the executable" `pwd`"/bin/lush."
	@echo ""
	@echo "If you have root permissions, you can also perform a"
	@echo "system wide installation by typing 'make install'"
	@echo "-------------------------------------------------------"

post-depend:
	@echo Done.

post-clean:
	-${RM} 2>/dev/null ${mysysdir}/stdenv.dump


INSTALLDIRS =  etc include src sys lsh packages
FINDDIRS  = \( -type d -name C\* -prune \) -o \( -type d -print \)
FINDFILES = \( -type d -name C\* -prune \) -o \( -type f -print \)

install-sub: FORCE
	@echo "-- Installing executable"
	${INSTALL} -d ${bindir}
	${INSTALL} -m 755 src/lush ${bindir}
	@echo "-- Installing manpage"
	${INSTALL} -d ${mandir}/man1
	${INSTALL} ${srcdir}/debian/lush.1 ${mandir}/man1
	@echo "-- Creating data directories"
	${INSTALL} -d ${datadir}/lush
	cd ${srcdir} ;\
	for subdir in ${INSTALLDIRS} ; do \
	  for f in `find $$subdir ${FINDDIRS}` ; do \
	    ${INSTALL} -d  ${datadir}/lush/$$f ; done ; done
	@echo "-- Creating data files"
	cd ${srcdir} ;\
	for subdir in  ${INSTALLDIRS} ; do \
	  for f in `find $$subdir ${FINDFILES}` ; do \
	    ${INSTALL} ${srcdir}/$$f ${datadir}/lush/$$f ; done ; done
	@echo "-- Creating standard dump file"
	${bindir}/lush @sysenv stdenv -- ${datadir}/lush/sys/stdenv.dump


install-nolink: install-sub
	@echo "-- Install done."

install: all install-sub
	-@if test ${bindir} != /usr/bin ; then \
	    echo "-- Trying to setup a link in the standard lush location." ; \
	    echo "-- You could have avoided this step with 'make install-nolink'." ; \
	    echo ln -s ${bindir}/lush /usr/bin/lush ; \
	    ln -s ${bindir}/lush /usr/bin/lush && ls -l /usr/bin/lush ; \
	  fi || true
	@echo "-- Install done."

distclean: FORCE
	for d in ${SUBDIRS}; do ( cd $$d && ${MAKE} $@ ); done
	-${RM} 2>/dev/null include/config.h include/autoconf.h 
	-${RM} 2>/dev/null -rf autom4te.cache
	-${RM} 2>/dev/null -rf bin/lush bin/lush~[0-9]
	-${RM} 2>/dev/null Makefile config.log config.status

FORCE:

.PHONY: FORCE
